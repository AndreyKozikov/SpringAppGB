# Итоговая аттестация

При выполнении задания к итоговой аттестации в приложении постарался реализовать основные аспекты, которые были изучены. Не хватило времени реализовать микросервисы (возникли сложности с интеграцией со Spring Securiry)
Оформлена `пояснительная записка.docx`

Документация к проекту доступна в \target\site\apidocs\index.html

---

## Изменения в проекте

---

### Урок 11. Spring Actuator. Настройка мониторинга с Prometheus и Grafana.

В приложение добавлен Spring Actuator для отслеживания метрик вашего приложения. Настроена возможность визуализация 
этих метрик с использованием Prometheus и Grafana.

---

### Урок 10. Spring Testing. JUnit и Mockito для написания тестов.

Задание: Напишите тесты для основной логики вашего приложения с использованием Spring Testing, JUnit и Mockito.
В процессе выполнения задания для микросервиса UserProjectService были разработаны:

класс ProjectServiceUnitTest.java, содержащий юнит-тест updateProjectByIdUnitTest метода updateProjectById 
сервиса ProjectService.java

класс ProjectServiceIntegrationTest.java, соддержащий интеграционные тесты методов сервиса ProjectService.java

---

15 ноября 2024

### Урок 8. Spring AOP, управление транзакциями.

Создан класс GBAspect, в котором содержатся аспекты для логирования некоторых операций проекта.

Для работы с аспектами созданы интерфейсы `AuthInterface`, `AuthServiceInterface` и `UserServiceInterface`.

---

10 ноября 2024

### Урок 7. Spring Security. Работа с JWT. Защита от основных видов атак.

Добавлена аутентификация и валидация пользователей по логину и паролю, JWT токену.

При успешной аутентификации пользователя ему выдается вновь сгенерированный токен, время жизни токена установлено 
в файле `application.yml`. Сгенерированный токен сохраняется в Cookie (HttpOnly) и передается пользователю.
Все модули аутентификации и валидации помещены в папку `Authorization`.

`JwtKeyProvider` предусматривает возможность генерации, сохранения в файл и чтения из файла приватного и публичного ключей
для подписания и проверки JWT токенов.

`JwtTokenProvider` предоставляет мметоды работы с токеном.

`AuthControllerApi` содержит эндпоинты для получения токена, а также выдачи токена пользователю после проверки логина и пароля.

`AutuService` содержит бизнес-логику для аутентификации пользователей и генерации JWT токена.

Начато создание глобального обработчика исключений `GlobalExceptionHandler`. 

Роли в проекте перенесены в enumerate класс `Roles`.

Для передачи логина и пароля из формы аутентификации предусмотрен DTO класс `JwtRequest`.

Переделаны эндпоинты работы с пользователями и проектами для обеспечения возможности работы в сервисе
в зависимости от роли пользователя (пока реализованы ADMIN и USER).

`JwtAuthenticationFilter` позволяет передать токен в заголовке или в куке (работа в сервисах при передаче токена 
в заголовке реализована не во всех сервисах).

---


4 ноября 2024

### Урок 6. Проектирование и реализация API для серверного приложения.

Реализованы RESTful API для приложения. API включает операции для создания, чтения, обновления и 
удаления пользователей и проектов. Методы реализованы в классах `ProjectControllerAPI`, `UserControllerAPI`. 
Добавлены соответствующие методы и запросы в интерфейсах `ProjectRepository` и `UserRepository`. 

Изменены WEB страницы: отдельно создана страница для управления проектами, отдельно для управления пользователями.

Механизм удаления взаимосвязанных данных из таблицы `users_project` при удалении пользователя или проекта
сделан через добавление аннотаций `@OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)`
в таблице `users`,  аннотации `@OneToMany(mappedBy = "project", cascade = CascadeType.ALL, orphanRemoval = true)` 
в таблице `projects`

Для обработки запроса на добавление пользователя создан отдельный класс `UserDTO` (Data Transfer Object).

Добавлены классы конфигурации `AppSpringConfig` и `MyDispatcherServletInitializer`. Добавлен метод 
`registerHiddenFieldFilter` для обработки PATCH и DELETE запросов.

---

# Задание
Ваша команда разрабатывает приложение для управления проектами. Вам нужно реализовать функциональность 
связывания пользователей с проектами.

### Создайте сущность "пользователь" (User), которая будет содержать следующие поля:

Идентификатор (id) типа Long, генерируемый автоматически при создании записи

Имя пользователя (username) типа String

Пароль (password) типа String

Электронная почта (email) типа String

Роль (role) типа String


### Создайте сущность "проект" (Project), которая будет содержать следующие поля:

Идентификатор (id) типа Long, генерируемый автоматически при создании записи

Название проекта (name) типа String

Описание проекта (description) типа String

Дата создания (createdDate) типа LocalDate


### Создайте абстрактный класс "сущность со связью" (EntityWithRelation), который будет содержать следующие поля:

Идентификатор (id) типа Long, генерируемый автоматически при создании записи

Идентификатор связанной сущности (relatedEntityId) типа Long


### Создайте сущность "пользователи проекта" (UsersProject), которая наследуется от класса "сущность с связью" и будет содержать следующие поля:

Идентификатор проекта (projectId) типа Long

Идентификатор пользователя (userId) типа Long


### Создайте интерфейс репозитория (UserRepository), который будет расширять JpaRepository<User, Long>.

### Создайте интерфейс репозитория (ProjectRepository), который будет расширять JpaRepository<Project, Long>.

### Создайте интерфейс репозитория (UsersProjectRepository), который будет расширять JpaRepository<UsersProject, Long>.


### Создайте сервисный класс (UserProjectService), который будет содержать следующие методы:

public List getUsersByProjectId(Long projectId) - метод, возвращающий список пользователей, связанных с определенным проектом

public List getProjectsByUserId(Long userId) - метод, возвращающий список проектов, связанных с определенным пользователем

public void addUserToProject(Long userId, Long projectId) - метод, добавляющий пользователя к проекту

public void removeUserFromProject(Long userId, Long projectId) - метод, удаляющий пользователя из проекта


### Создайте контроллер (UserProjectController), который будет содержать следующие методы:

public ResponseEntity<List> getUsersByProjectId(Long projectId) - метод, обрабатывающий GET-запрос для получения списка пользователей, связанных с определенным проектом

public ResponseEntity<List> getProjectsByUserId(Long userId) - метод, обрабатывающий GET-запрос для получения списка проектов, связанных с определенным пользователем

public ResponseEntity addUserToProject(Long userId, Long projectId) - Метод, обрабатывающий POST-запрос для добавления пользователя к проекту

public ResponseEntity removeUserFromProject(Long userId, Long projectId) - метод, обрабатывающий POST-запрос для удаления пользователя из проекта

